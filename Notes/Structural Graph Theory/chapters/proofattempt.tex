
\chapter{Proof of Conjecture}\label{chap:Proving_The_Theorem}
Our aim is to prove the following conjecture. Recall the definition of $\mathcal{G}(g, p, k, a)$ from \cref{thm:gmst}. 
\begin{conjecture}\label{conj:gmst_conjecture_pagenumber}
	All graphs $G$ in $\mathcal{G}(g, p, k, a)$ can be embedded on \(f(g, p, k, a)\) pages.
\end{conjecture}
Our aim is to show that all graphs of genus \(g\) containing \(p\) vortices of width \(k\) can be embedd on \(f(g, p, k)\) pages. If $G$ is a graph with a tree-decomposition where every torso is $(g, p, k)$-almost embeddable, then from \cref{thm:clique_sum_pagenumber_bound}, $G$ has bounded pagenumber. If there exists a set $A \subseteq V(G)$ such that $G - A$ has the tree-decomposition above, then from \cref{thm:apex_vertices_pagenumber}, the pagenumber of $G$ is bounded.

It is trivial to show that $a$ apex vertices require at most $a$ additional pages.
\section{Apex vertices}
In this section, we prove that apex vertices can be added with a bounded increase to the number of pages. Typically, apex vertices are the most problematic ingredient when applying the Graph Minor Structure theorem, but in this case they are a trivial addition.
\begin{theorem}\label{thm:apex_vertices_pagenumber}
	If \(G\) is a graph with vertex partition \((A, B)\) such that \(G' = G[B]\) is embeddable on $s$ pages, then \(G\) is embeddable on \(s + |A| \) pages.
\end{theorem}
\begin{proof}
	Let \(G'\) have a book-embedding \((<, \rho)\) on $s$ pages. Place the vertices of \(A\) at the very start of \((<)\), with order $u_1, u_2, \ldots, u_a$. For every edge \(u_i v \), \(u_i \in A\), \(v \in G'\), colour \(\rho(uv) = i\), and for any edge \(u_i u_j\) where $u_i, u_j \in A$, $i < j$, colour $u_i u_j$ with colour $i$. Then this is a proper book-embedding. If two edges $uv$, $xy$ cross, then $uv$ and $xy$ are given different colours. If $uv, xy \in E(G')$, then $uv, xy$ are given different colours as $(< \rho)$ is a book-embedding of $G'$. If $u$ or $x$ are in $A$, then $uv, xy$ have different colours because their leftmost vertices are different. The number of pages necessary is $s + |A|$. 
\end{proof}

Therefore, a fixed number of apex vertices do not affect the pagenumber.

\section{Almost-Embeddable Graphs}
Recall the definition of $(g, p, k, a)$-almost-embeddable from \cref{ssec:Robertson_Seymour_Graph_Structure}. We say a graph $G$ is $(g, p, k)$-almost-embeddable if $G$ is $(g, p, k, a)$-almost-embeddable and $a = 0$, so $G$ has no apex set.

We wish to find a book-embedding of $(g, p, k)$-almost-embeddable graphs.
The most problematic section is dealing with vortices on surfaces.
We aim to work with vortices by considering how an ordering affects the face that the vortex is sitting on, and seeing what happens when the vortex is added onto the face.
What we plan to show is this:
\begin{conjecture}
	Suppose $G$ is $(g, p, k)$-almost-embeddable.Then $G$ can be embedded on \(f(g, p, k)\) pages for some function $f$.
\end{conjecture}
The way we are planning to deal with vortices is to deal with the faces. We have the following lemma \cref{lem:vortices_mono_paths}. 

Let \(G\) be a graph. A vertex ordering \((<)\) \textit{preserves} a face \(F\) if there is a vertex \(v_0\) on the boundary of \(F\) and a vertex ordering \((v_0, v_1, \ldots, v_k)\) around the boundary of \(F\) such that \(v_0 < v_1 < \cdots < v_k\).
A circular ordering \(<\) preserves a face \(F\) if we can start at any point in the circular ordering and have the condition above.
Now consider when \(G\) does not have a preserved face, but we can partition the edges into sections where each section is preserved. Let \(F\) be a face on \(G\). Let \( (<, \varphi) \) be a book-embedding of \(G\). A path \(P\) on the boundary of \(F\) is a \textit{monochromatic path} if all the edges on \(P\) are given the same colour with respect to \( \varphi \). 

The list below are the steps taken to prove the conjecture.
\begin{enumerate}
	\item Let $G$ be a \(4\)-connected planar graph. We preserve all faces and all faces are monochromatic.
	\item Suppose \(G\) is a connected planar graph. Faces are not preserved, but a fixed number of vertices are moved around on every face. Additional pages are necessary to embed $G$, but the number of monochromatic paths is fixed. 
	\item Suppose \(G\) is $2$-cell embedded on a surface. Use Heath and Istrail's \cite{heathPagenumberGenusGraphs1992} planar-nonplanar decomposition to find a spanning planar subgraph of $G$ and nonplanar edges. Then apply the previous steps to the spanning planar subgraph.
\end{enumerate}

\subsection{Faces and Monochromatic paths}

Preserved faces are very important, because of this lemma.

\begin{lemma}[Vortex on preserved faces]\label{lem:preserved_faces_pagenumber}
	Suppose a graph \(G\) has partition \(G = G_0 \cup G_1\), where \(G_0\) is embedded on a surface $\Sigma$ and \(G_1\) is a vortex on a face $F$ of $G_0$ with width \(k\). Suppose $(<, \varphi)$ is a $p$-page book-embedding of \(G_0\) which preserves \(F\). Then $G$ can be embedded on \(p + k + 1\) pages Furthermore, the new ordering restricted to $G_0$ is $(<, \varphi)$.
\end{lemma}
\todo{Add picture!}

\begin{proof}
	We repeat a similar argument to \cref{thm:bded_treewidth_bded_pagenumber}. Let \(B_1, \ldots, B_i\) be the path-decomposition of \(G_1\). Let \(\sigma(v)\) be the first time \(v\) appears in the path-decomposition. Colour the edges of \(G_1\) as such. If \(uv \in E(G_1)\), then:
	\begin{equation}
		c(uv) =
		\begin{cases}
			c(T_u) & \text{ if } \sigma(u) \leq \sigma(v), \\
			c(T_v) & \text{ if } \sigma(v) \leq \sigma(u)
		\end{cases}
	\end{equation}
	then is a book-embedding of \(G_1\) with \(k+1\) colours for the same reason as \cref{thm:bded_treewidth_bded_pagenumber}.
	To add this book-embedding to \(G_0\), we add the vertices that appear first in \(B_i\) after the associated vertex \(v_i\) in \(G_0\) such that \(v_i\) is on the face \(F\) and \(v_i \in B_i\). This is a book-embedding of \(G\) requiring at most \(\pn(G_0) + k + 1\) colours.
\end{proof}

\begin{lemma}\label{lem:vortices_mono_paths}
	Suppose \(G\) is a graph with components \(G_0\) and \(G_1\). Suppose \(G_0\) is embedded on a surface \(\Sigma \) of genus \(g\) and let \(F\) be a face on \(G_0\). Let \(v_1, v_2, \ldots, v_k\) be the vertices bordering \(F\), and let \(C\) be the cycle bordering \(F\). Let \(D\) be a \(G\)-clean disk on \(F\). Now suppose \(G_1\) is a vortex of width $k$ on \(D\) with a path-decomposition \((B_0, \ldots, B_l)\) and \(G_0\) has a book-embedding \((<, \varphi)\) on $s$ pages. Then partition the edges \(e_i = v_i v_{i + 1}\) (modulo \(k\)) such that the edges form a maximal \(\varphi \)-monochromatic path on \(C\). Suppose there are \(m\) monochromatic paths. Then \(G\) can be embedded on \(s + m(k+1)\) pages.
\end{lemma}
We shall prove an intermediate lemma.
\begin{lemma}\label{lem:one_page_decomposition}
	Let \((B_1, \ldots, B_n)\) be a path-decomposition of \(G\) with path-width \(k\). Let \(x_1, \ldots, x_n\) be vertices in \(G\) such that \(x_i \in B_i\) for all \(i\), and suppose \(P\) is an induced path \((x_1, x_2, \ldots, x_n)\) in \(G\). Then for every one-page embedding of \(P\), \(G\) has a \((k + 1)\)-page embedding.
\end{lemma}
\begin{proof}
	Suppose \(G\) has the structure as described in \cref{lem:vortices_mono_paths}. 
	The proof given is very similar to the one in \cref{lem:preserved_faces_pagenumber}. For each vertex \(v\) in \(G\), we let \(\sigma(v)\) be the index of the first bag \(v\) appears in. Then in the book-embedding of \(G\), we place all bags of \(v_i\) after \(x_i\) in the book-embedding, following the orientation of the path with the book-embedding. We also colour the edges in the same way above: 
	\begin{equation}
		c(uv) =
		\begin{cases}
			c(T_u) & \text{ if } \sigma(u) \leq \sigma(v), \\
			c(T_v) & \text{ if } \sigma(v) \leq \sigma(u)
		\end{cases}
	\end{equation}.

	Then we have that if two edges cross in the book-embedding, then they have different colours. If two edges cross, then that implies that in a book-embedding of the path \(P\) with \((B_1, \ldots, B_n)\) added in like \cref{lem:preserved_faces_pagenumber}, then they will cross as well. But as that that implies they have different colours, then in this new embedding they have different colours as well. Two examples are given in \cref{fig:preserving_pages}.

	This is a small tweak of \cref{lem:preserved_faces_pagenumber}. 
\end{proof}

\begin{figure}
	\centering
	\includesvg[pretex=\tiny, width = 0.8 \textwidth]{figures/one_page_embedding.svg}
	\caption{Description of \cref{lem:one_page_decomposition}.\(x_1, \ldots, x_n\) are the vertices with a path that is a single book-embedding and \(B_1, \ldots, B_n\) are the bags of the embedding. Notice that there are two different ways that the \(n + 1\)-th bag can end up, but both ways stil maintain the property that this is a book-embedding. This diagram is a circular ordering of \(x_1, \ldots, x_n\) as it is more compact to draw.}\label{fig:preserving_pages}
\end{figure}

We shall now prove \cref{lem:vortices_mono_paths}.
\begin{proof}[Book-embedding lemma]
	We use the path-decomposition on \(G'\) as the set \((B_1, \cdot , B_n)\) in proving \cref{lem:vortices_mono_paths}. We apply \cref{lem:one_page_decomposition} for the monochromatic \(v_i\) to each of the monochromatic paths. From the construction of the vortices in \cref{lem:preserved_faces_pagenumber}, we add on the faces in the exact order. Then we have that the monochromatic paths are preserved in the ordering, and in fact they are bounded as from \cref{lem:one_page_decomposition} they are bounded.
\end{proof}
\subsection{Planar graphs}
\begin{lemma}\label{lem:Hamiltonian_preserved_faces}
	Let \(G\) be a Hamiltonian planar graph. Then there exists a book-embedding $(\leq, \varphi)$ on two pages where every face of $G$ is preserved.
\end{lemma}

\begin{proof}
	Let \(C\) be the Hamiltonian cycle of \(G\). Let \(D\) be the circular ordering of these vertices by traversing \(C\). Now as \(G\) is planar, \(C\) splits the surface into an interior region and an exterior region, by the Jordan curve theorem. So every face is inside either the interior or exterior of \(C\). But this means that every face must be preserved in \(D\), as the surface we are dealing with is orientable and we can affix an orientation to every face \(F\) such that the order of the vertices in the orientation is the same order as the orientation in \(D\). Thus every face in this embedding is preserved.
	\begin{figure}[h]
		\centering
		\includesvg[pretex=\tiny, width=0.3\linewidth]{figures/hamiltonian-planar}
		\caption{An image of a Hamiltonian planar graph. If we have a circular ordering of the vertices, going clockwise around the Hamiltonian cycle, then every face is preserved.}\label{fig:hamiltonian_planar}
	\end{figure}
\end{proof}
As a consequence, every 4-connected planar graph has a circular ordering which preserves every face.

We first do the planar-nonplanar decomposition of \(G\).
Then we look at the planar subgraph \(G_p\) and decompose \(G_p\) into 4-connected components with adhesion at most 3, from \cref{lem:planar_graphs_4_connected_cliqesums}.
From Tutte's theorem on planar graphs \cite{tutteTheoremPlanarGraphs1956}, we have that if \(G\) is a 4-connected planar graph, then the vertex ordering of the Hamiltonian cycle \((\leq)\) preserves all faces on \(G\).
In Hickingbotham's proof \cref{ssec:Clique_sum_Pagenumber_bound}, we have to move three vertices to the start of the decomposition. This will be a problem, but we claim that for every distinguished face \(F\) which touches these vertices, the number of pages needed to embed \(F\) is bounded.


\begin{theorem}\label{thm:embedded_graph}
	Let \( G \) be a planar graph embedded on $\mathbb{R}^2$. Then $G$ can be embedded on 11 pages where every face has at most $12$ monochromatic paths. 
\end{theorem}

\begin{proof}
	Use theorem \cref{lem:planar_graphs_4_connected_cliqesums} to build a tree-decomposition $(B_x : x \in T)$ of $G$ with $4$-connected planar torsos of adhesion 3. Each torso $G \langle B_x \rangle$ has a tree-decomposition where every face is preserved, from \cref{lem:Hamiltonian_preserved_faces}. Then apply \cref{thm:clique_sum_pagenumber_bound} to embed $G$ in a book. At most three vertices are moved to the front in each torso. By the construction of the $4$-connected planar graphs, every face $F$ has at most three vertices moved to the front. Each vertex moved forces two edges to be on an individual monochromatic path, and paths between front vertices are also chaged. Therefore, every face has at most $12$ monochromatic paths, as each vertex adds at most four additional monochromatic paths. By \cref{thm:Planar Graph Hickingbotham Bound}, $G$ can be embedded on $11$ pages.
\end{proof}

\section{Surfaces}
In this section, we discuss surfaces and a method for dealing with faces on surfaces.
\subsection{Non-planar decomposition}
Suppose we have a graph \(G\) embedded on a surface. We apply Heath and Istrail's planar-nonplanar decomposition~\cite{heathPagenumberGenusGraphs1992} to break up the edges of \(G\) into \(E_p\) and \(E_n\), edges that are planar and nonplanar. If \(F\) is bounded by planar edges, then we have that we can add a vortex to \(F\) with a bounded number of pages. If \(F\) is bounded by some non-planar edges, then we need additional lemmas.
We wish to show this statement:
\begin{theorem}
	For all graphs \(G\) of genus \(g\), there exists a \(11g + 24\)-page book embedding such that all faces of $G$ have at most \( 12(g + 1)\) monochromatic paths.
\end{theorem}
Consider \(E_n\), the edges not in the planar decomposition. Consider \(F_n\), the faces \(F\) such that there exists an edge \(e\) in \(E_n\) which bounds \(F\). Then we claim that the number of edges that bound \(F\) is bounded. We first need an auxillary topological conjecture. We say a loop is \textit{null-homotopic} if it is homotopy equivalent to a constant loop, and \textit{nontrivial} if this is not the case. A \textit{facial walk} is a sequence of edges \(e_1, \ldots, e_n\) that bound a face such that \(e_i\) is incident to \(e_{i + 1}\) modulo \(n\) for all \(i\). The length of the facial walk is \(n\). We denote a surface without some set of points $A$ as $\Sigma - A$. 

\begin{lemma}\label{lem:orientable_facial_walks}
	Let \(\Sigma \) be a surface of Euler genus \(g\) and let \(x_0\) be a point on the surface. Then let \(L\) be an arbitrary set of nontrivial, non-intersecting loops that start and end at \(x_0\) on \(\Sigma \). Then let \(F_1, \ldots, F_j\) be faces on \(\Sigma - L\), such that each \(F_i\) is homeomorphic to a disk. Let $G$ be the graph with vertex set $\{x_0 \}$ and vertex set $L$. Then the length of the facial walk for all \(F\) is at most \(2g\).
\end{lemma}

Parts of the proof was motivated by a discussion with Corbin Reid. The proof given is a topological one.

\begin{proof}
	Let \(G'\) be the dual multigraph of $G$, where the vertex set is \(F_1, \ldots, F_j\) and the edge set are the loops, where two faces are incident if there is a loop that is touching both faces. Then take a spanning tree \(T\) of \(G'\), and let \(L''\) be the loops in $L$ that cross an edge in \(T\). Let $L'$ be the remaining loops, so $L - L'$. 
	Then consider the surface \(\Sigma - L'\), so the surface $\Sigma - L$ with the loops $L''$ added back in. Now this bounds a face homeomorphic to a disk, call the face \(F_0\). 
	
	We can show that this is homeomorphic to a disk using induction. We can treat forming the face $F_0$ as the following operation on the surface $\Sigma - L$ by adding back in the loops in $L''$. Suppose a loop $\gamma$ is on the boundary of two faces $F_i$ and $F_j$, and is in $L''$. Then adding the loop $\gamma$ to $\Sigma$ will maintain the fact that concatenating $F_i$ and $F_j$ is still a disk. Then as we add back in a tree of loops, then there will be no cycles formed from this operation, and as the tree is spanning, then every face is added to $F_0$. Therefore, we have that there is only one face left, $F_0$, and that $F_0$ is homeomorphic to a disk. 

	Now we have that there is one vertex, \(|L'|\) edges, and one face \(F_0\). Then by Euler's formula, we have that:
	\begin{equation}
		n - m + f = 2 - g
	\end{equation}
	therefore, we have that \(1 - |L'| + 1 = 2 - g\), or that \(|L'| = g\). As every edge is traversed twice on either side on the facial walk, we have that the length of the facial walk is \(2g\).
	Now let us add each edge from \(L''\), one at a time. We shall show that every face after adding all edges from \(L''\) to \(L'\) has a facial walk length of \(\leq 2g\).

	Before adding any edge, we have \(F_0\) has \(\leq 2g\) on the facial walk. Now suppose we have added loops \(\gamma_1, \ldots, \gamma_{i - 1}\), and suppose every face has a facial walk length of \(\leq 2g\).
	Then suppose loop \(\gamma_i\) splits face \(F\) into faces \(F_1\) and \(F_2\). We have that the facial walk length \(|F_1|\) and \(|F_2|\) are at least 2, the sum is \(F + 2\). Then we have that:
	\begin{equation}
		2 + |F_2| \leq |F_1| + |F_2| = |F| + 2 \leq 2g + 2
	\end{equation}
	so \(|F_2| \leq 2g\) and by symmetry so does \(|F_1|\). Thus shown.
\end{proof}

\todo{show why this does not work in the non-orientable case, or alternatively show this works on all surfaces}.

\begin{corollary}\label{corr:orientable_nonplanar_faces}
	Let \(G\) be a graph embedded on an orientable surface \(\Sigma\) with a planar-nonplanar decomposition and let \(F\) be a nonplanar face. Suppose \(G\) has genus \(g\). Then \(F\) transitions between edges on the boundary of $G_p$ and nonplanar edges at most $4g$ times.
\end{corollary}

\begin{proof}
	Contract \(G\) to a point. Then \(F\) has at most \(2g\) edges on its surface, from \cref{lem:orientable_facial_walks}. Every loop that is maintained after contracting $G$ to a point is nontrivial as trivial loops are surface loops.
	Then every nonplanar face alternates between having a planar trace and nonplanar edge at most \(4g\) times.
\end{proof}

\section{Putting the pieces together}
So we have gone from 4-connected planar graphs, to planar graphs, to graphs on orientable surfaces while bounding the number of monochromatic paths of all faces. This allows us to place vortices with only a bounded increase in the number of pages needed.
The main theorem we want to prove is:
\begin{theorem}\label{thm:orientablevortices}
	Let $G$ be a graph where all torsos are $k$ almost-embeddable on an orientable surface of genus at most $g$.  Now suppose there are $p$ vortices which are embedded on $G$. Then $G$ has bounded pagenumber.
\end{theorem}
\todo{calculate expicit bounds of the pagenumber wrt k, g, p}.

We will prove this by starting with planar graphs, then bounded genus graphs. We show that the number of monochromatic paths on these graphs is bounded for every face. Then we will show that because the number of monochromatic paths for every face is bounded, we can add vortices.

\begin{lemma}\label{lem:orientablesurfaces_monochromatic_edges}
	Let $G$ be a graph embedded on a surface of genus at most $g$. Then there exists a book-embedding $(<, \varphi)$ with $11 + 18g$ pages where every face of $G$ has $ \leq 4g$ monochromatic paths.
\end{lemma}
\begin{proof}
	Let $G$ be such a graph. We have that $G$ has a planar-nonplanar decomposition, $G_p$ and $E_n$, where $G_p$ is a spanning planar subgraph of $G$ and $E_n$ are nonplanar edges. From \cref{thm:embedded_graph}, there exists a book-embedding of $G_p$ in $11$ pages. To embed $E_n$, collect edges of the same homotopy type together. These edges can be embedded on $18g$ pages from \cref{lem:planar_nonplanar_orientable}, when $G$ is orientable, and a similar scheme can be used when $G$ is nonorientable. The reason this works is because the outerface is preserved in the $4$-connected tree-decomposition, which is a necessary condition in the orientable and nonorientable case.
	From \cref{corr:orientable_nonplanar_faces} every face has a bounded number of monochromatic paths. However, every nonplanar edge splits a monochromatic path in two. Therefore, every face of $G$ has at most $12 + 3 \times 4g = 12(g + 1)$ monochromatic paths.
\end{proof}
\begin{lemma}\label{lem:orientablesurfaces_almostembeddable}
	Let $G$ be a graph $k$-almost embeddable on an orientable surface of genus at most $g$, with $p$ vortices on $G$. Then $G$ has a book-embedding with at most $11 + 18g + 12(k + 1)(g + 1)$ pages.
\end{lemma}

\begin{proof}
	Suppose $G$ is $k$-almost-embeddable on a surface of genus $g$. Suppose $G = G_0 \cup G_1 \cup \ldots \cup G_p$, where $G_0$ is embeddable on a surface of genus $G$, and $G_i$, $1 \leq i \leq p$ are vortices. Then there exists a book-embedding $(<, \psi)$ with $11 + 18g$ pages where every face has $12(g+1)$ monochromatic paths, from \cref{lem:orientablesurfaces_monochromatic_edges}. But then from \cref{lem:vortices_mono_paths}, this means that every $G_1, \ldots, G_p$ on $G_0$ can be embedded in at most $11 + 18g + 12(k + 1)(g + 1)$ pages. Thus shown.
\end{proof}

Now to prove the main theorem:
\begin{proof}
	Let every torso of $G$ be $k$-almost-embeddable. Then from \cref{lem:orientablesurfaces_almostembeddable} that every torso requires at most $s = 11 + 18g + 12(k + 1)(g + 1)$-pages with adhesion at most $\ell$. Then from \cref{corr:bded_pn_tree_decomp},  $G$ needs at most $(2s + 2)(s) + \ell$ pages.
\end{proof}

As a corollary,

\begin{corollary}
	Suppose $G$ is in $\mathcal{G}(g, p, k, a)$. Then $G$ can be embedded on $(2s + 2)(s) + \ell + a$ pages. 
\end{corollary}
Finally, apex vertices are handled with \cref{thm:apex_vertices_pagenumber}. Thus we conclude a partial result using \textcite{robertsonGraphMinorsXVI2003} to show that some $K_t$-minor free graphs, ones where every torso is $k$-almost-embeddable on an orientable surface, satisfy the conjecture.
\todo{Write the proof more carefully!}

\input{chapters/consequences}
