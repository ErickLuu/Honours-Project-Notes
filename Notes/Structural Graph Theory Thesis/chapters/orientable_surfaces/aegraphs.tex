\section{Monochromatic paths}

We wish to find a book-embedding of an almost-embeddable graph on some orientable surface. To do so, we need to introduce some new terminology to work with vortices on surfaces. 
Recall the definition of $(g, p, k, a)$-almost-embeddable from \cref{ssec:Robertson_Seymour_Graph_Structure}. A graph $G$ is $(g, p, k)$-almost-embeddable if $G$ is $(g, p, k, 0)$-almost-embeddable, so $G$ has no apex set.
What we plan to show is this:
\begin{theorem}\label{thm:bounded_almost_embeddable}
	Suppose $G$ is $(g, p, k)$-almost embeddable on an orientable surface. Then $G$ can be embedded on \(f(g, p, k)\) pages for some function $f$.
\end{theorem}

The most problematic section is dealing with vortices on surfaces.
To work with vortices, consider how an ordering affects the face that the vortex is sitting on. Then see what happens when the vortex is added onto the face. 

Let \(F\) be a face on \(G\). Let \( (<, \varphi) \) be a book-embedding of \(G\). A \textit{monochromatic path} $P$ on the boundary of $F$ is a maximal path where every edge is given the same colour from $\varphi$. $F$ being a preserved face implies that $F$ has a single monochromatic path, but not the other way around. 

\begin{figure}[h!]
	\centering
	\includesvg[width = 0.8\textwidth]{figures/monochromatic_paths.svg}
	\caption[Monochromatic paths]{An example of a monochromatic path on a face. Above is a face embedded on $\mathbb{R}^2$. The circular book-embedding has edges coloured red and blue. This face has four monochromatic paths. Below is a circular ordering of the vertices on the boundary of the face. Every edge coloured red is embedded on a single page.}
\end{figure}


The list below are the steps taken to prove \cref{thm:bounded_almost_embeddable}.
\begin{enumerate}
	\item Suppose $G$ is a \(4\)-connected planar graph. There is a book-embedding where every face is monochromatic, by \cref{thm:4-connected_planar_ham_cycle}. 
	\item Suppose \(G\) is a connected planar graph. Faces are not preserved, but a fixed number of vertices are moved around on every face. Additional pages are necessary to embed $G$, but the number of monochromatic paths is bounded. 
	\item Suppose \(G\) is $2$-cell embedded on an orientable surface. \textcite{heathPagenumberGenusGraphs1992} gives a planar-nonplanar decomposition of $G$. Then apply the previous steps to the spanning planar subgraph and add vortices.
\end{enumerate}

Preserved faces allow us to embed vortices with a bounded number of pages. 

\begin{lemma}[Vortex on preserved faces]\label{lem:preserved_faces_pagenumber}
	Suppose a graph \(G = G_0 \cup G_1\), where \(G_0\) is embedded on a surface $\Sigma$ and \(G_1\) is a vortex on a face $F$ of $G_0$ with depth \(k\). Suppose $(<, \varphi)$ is a $p$-page book-embedding of \(G_0\) which preserves \(F\). Then $G$ can be embedded on \(p + k + 1\) pages. Furthermore, the new ordering restricted to $G_0$ is $(<, \varphi)$.
\end{lemma}

\begin{proof}
	We repeat a similar argument to \cref{thm:bded_treewidth_bded_pagenumber}. Let \(B_1, \ldots, B_i\) be a path-decomposition of \(G_1\). Let \(\sigma(v)\) be the first time \(v\) appears in the path-decomposition. Colour the edges of \(G_1\) as such. If \(uv \in E(G_1)\), then:
	\begin{equation}
		c(uv) =
		\begin{cases}
			c(T_u) & \text{ if } \sigma(u) \leq \sigma(v), \\
			c(T_v) & \text{ if } \sigma(v) \leq \sigma(u).
		\end{cases}
	\end{equation}
	This is a book-embedding of \(G_1\) with \(k+1\) colours. Since the intersection graphs of every graph is perfect, we can colour with $k + 1$ colours. Furthermore, suppose that edges \(uv\), \(xy\) cross, so \(\sigma(u) \leq \sigma(x) \leq \sigma(v) \leq \sigma(y)\). However, this implies that $u,x,v$ are in some bag $B$. \(uv\) is an edge in \(B\), and we do a depth-first search to establish the ordering of $\sigma(u)$. So \(u, x, v\) are in the same bags. However, this implies that the trees \(T_u\) and \(T_x\) intersect, meaning that \(c(uv) \neq c(xy)\). Therefore, all crossing edges are assigned different colours. 

	To add this book-embedding to \(G_0\), add the vertices that appear first in \(B_i\) after the associated vertex \(v_i\) in \(G_0\) such that \(v_i\) is on the face \(F\) and \(v_i \in B_i\). This is a book-embedding of \(G\) requiring at most \(\pn(G_0) + k + 1\) colours. An illustration of such a book-embedding is in \cref{fig:preserved_face}.
\end{proof}

\begin{figure}[h!]
	\centering
	\includesvg[pretex=\tiny, width = 0.8\textwidth]{figures/bookembedding_preserved_face.svg}
	\caption[Book-embedding of a preserved face]{A book-embedding of a preserved face  with a vortex on the face. The green vertices are the boundary of the face and the other coloured vertices are distinct vertices in each bag. The bag is the red circle. This graph can be embedded on $3$ pages as the depth of the vortex attached is 2. }\label{fig:preserved_face}
\end{figure}

\begin{lemma}\label{lem:vortices_mono_paths}
	Suppose \(G\) is a graph where $G = G_0 \cup G_1$, where \(G_0\) is embedded on a surface \(\Sigma \) of genus \(g\). Let \(F\) be a face on \(G_0\). Let \(v_1, v_2, \ldots, v_k\) be the vertices bordering \(F\). Let \(D\) be a \(G\)-clean disk on \(F\). Now suppose \(G_1\) is a vortex of depth $k$ on \(D\) with a path-decomposition \((B_0, \ldots, B_l)\) and \(G_0\) has a book-embedding \((<, \varphi)\) on $s$ pages. Suppose there are at most \(m\) monochromatic paths for every face on $G_0$. Then \(G\) can be embedded on \(s + m(k+1)\) pages.
\end{lemma}

\cref{lem:vortices_mono_paths} implies \cref{corr:vortices_paths_pn}.

\begin{corollary}\label{corr:vortices_paths_pn}
	Suppose $G$ is a graph where $G = G_0 \cup G_1 \cup \ldots \cup G_P$, $G_0$ is embedded on a surface $\Sigma$ of genus $g$, and $G_1, \ldots ,G_P$ are vortices on $G_0$. Suppose further that $G_0$ has $m$ monochromatic paths on each of its faces on $\Sigma$. Then $G$ can be embedded on $s + pm(k+1)$ pages.
\end{corollary}

This is proven by adding $G_1, \ldots, G_P$ to $G_0$ one at a time and applying \cref{lem:vortices_mono_paths} each time. To prove \cref{lem:vortices_mono_paths}, we prove \cref{lem:one_page_decomposition}.
\begin{lemma}\label{lem:one_page_decomposition}
	Let \((B_1, \ldots, B_n)\) be a path-decomposition of \(G\) with path-width \(k\). Let \(x_1, \ldots, x_n\) be vertices in \(G\) such that \(x_i \in B_i\) for all \(i\), and suppose \(P\) is an induced path \((x_1, x_2, \ldots, x_n)\) in \(G\). Then for every one-page embedding of \(P\), \(G\) has a \((k + 1)\)-page embedding where $P$ is preserved in the book-embedding.
\end{lemma}
\begin{proof}
	The proof given is similar to the one in \cref{lem:preserved_faces_pagenumber}. 
	Suppose \(G\) has the structure as described in \cref{lem:vortices_mono_paths}. For each vertex \(v\) in \(G\), let \(\sigma(v)\) be the index of the first bag \(v\) appears in. Then in the book-embedding of \(G\), place all bags of \(v_i\) after \(x_i\) in the book-embedding, following the orientation of the path with the book-embedding. Colour the edges like so:
	\begin{equation}
		c(uv) =
		\begin{cases}
			c(T_u) & \text{ if } \sigma(u) \leq \sigma(v), \\
			c(T_v) & \text{ if } \sigma(v) \leq \sigma(u).
		\end{cases}
	\end{equation}

	Then if two edges cross in the book-embedding, then they have different colours. If two edges cross, then that implies that in a book-embedding of the path \(P\) with \((B_1, \ldots, B_n)\) added in like \cref{lem:preserved_faces_pagenumber}, then they will cross as well. Two examples are given in \cref{fig:preserving_pages}.
\end{proof}

\begin{figure}[h!]
	\centering
	\includesvg[pretex=\tiny, width = 0.8\textwidth]{figures/one_page_embedding.svg}
	\caption[One-page decomposition]{Description of \cref{lem:one_page_decomposition}. \(x_1, \ldots, x_n\) are the vertices with a path that is a single book-embedding and \(B_1, \ldots, B_n\) are the bags of the embedding. Notice that there are two different ways that the \(n + 1\)-th bag can end up, but both ways still maintain the property that this is a book-embedding. This diagram is a circular ordering of \(x_1, \ldots, x_n\).}\label{fig:preserving_pages}
\end{figure}

We now prove \cref{lem:vortices_mono_paths}.
\begin{proof}
	Use the path-decomposition on \(G'\) as the set \((B_1, \ldots , B_n)\) in proving \cref{lem:vortices_mono_paths}. Then apply \cref{lem:one_page_decomposition} for the monochromatic \(v_i\) to each of the monochromatic paths. From the construction of the vortices in \cref{lem:preserved_faces_pagenumber}, add on the faces in the exact order. Then the monochromatic paths are preserved in the ordering, and in fact from \cref{lem:one_page_decomposition}, they are bounded.
\end{proof}
\begin{lemma}\label{lem:Hamiltonian_preserved_faces}
	Let \(G\) be a Hamiltonian planar graph with Hamiltonian cycle $C$ Then there exists a book-embedding $(\leq, \varphi)$ on two pages where every face of $G$ is preserved, and the circular ordering of $\leq$ is $C$.
\end{lemma}

\begin{proof}
	Let \(<\) be the circular ordering of these vertices by traversing \(C\). Now as \(G\) is planar, \(C\) splits the surface into an interior region and an exterior region, by the Jordan curve theorem. So every edge in $G - C$ is inside either the interior or exterior of \(C\). Colour every edge in $C$ and on the interior of $\mathbb{R}^2 - C$ red and colour the other edges blue. This is a book-embedding as both regions can be embedded on a single page with the same cyclic ordering. Furthermore, every face is preserved. Because $\mathbb{R}$ is orientable, affix an orientation to every face \(F\) on $G$ such that the order of the vertices in the orientation is the same order as the orientation in \(D\).
	\begin{figure}[h!]
		\centering
		\includesvg[pretex=\tiny, width=0.3\linewidth]{figures/hamiltonian-planar}
		\caption[Hamiltonian planar graph]{This is a Hamiltonian planar graph with a book-embedding of 2. The linear ordering is $v_1, v_2, \ldots,  v_8$. Let $C$ be the Hamiltonian cycle. $C$ splits the plane into two regions. Then edges in the interior region and on $C$ are coloured red, and the remaining edges are blue. Now choosing any face and restricting the linear ordering to be around the face preserves each face. }\label{fig:hamiltonian_planar}
	\end{figure}
\end{proof}
From \cref{lem:Hamiltonian_preserved_faces}, if \(G\) is a Hamiltonian planar graph, then the vertex ordering of the Hamiltonian cycle \((\leq)\) preserves all faces on \(G\). As a consequence of \cref{thm:4-connected_planar_ham_cycle}, every 4-connected planar graph has a circular ordering which preserves every face.

Then this can be extended to every connected planar graph, adding a constant number of monochromatic paths, as shown by \cref{thm:planar_graph__be_mono_paths}.

\begin{lemma}\label{lemma:decomposition_faces}
	Let $G$ be a planar graph embedded on $\mathbb{R}^2$, and let $F$ be a face. The vertex set of $F$ has a tree-decomposition $(T, (B_x)_x)$ of adhesion 1 where each torso is a cycle.
\end{lemma}

\begin{proof}
	Suppose the facial walk of $F$ is a cycle $C$. Then there are no cut-vertices, so $C$ is a valid cycle.

	Now suppose $F$ has a cut vertex.Let $W$ be a facial walk of $F$, and suppose the sum times duplicate vertices appear is $n$. Suppose for all faces with walks with $n-1$ duplicate vertices, the lemma holds. Take a cut-vertex $v$ and look at the first and last time $v$ appears in $W$, call these positions $a, b$. Then let $W_1$ be the subwalk $W[a, b-1]$ and let $W_2$ be the subwalk of $W - W[a, b-1]$, removing $[a, b-1]$. Now both $W_1$ and $W_2$ bound subfaces of $F$. Then applying the inductive hypothesis, $W_1$ and $W_2$ have the decomposition above. Then there is a bag containing $v$ in the tree-decomposition of $W_1$ and $W_2$, so join the two bags. As $W_1$ and $W_2$ only have $v$ in common, then $w_1, w_2$ contain $w$. 
\end{proof}

We want to show that there exists a book-embedding of every planar graph where every face has a bounded number of monochromatic paths. We were able to prove it in the special case where there is no cut-set of size 3.

\begin{theorem}\label{thm:planar_graph__be_mono_paths}
	Let \( G \) be a planar graph embedded in $\mathbb{R}^2$, with $k$ sets of graphs with adhesion $3$. Then $G$ can be embedded on 11 pages where every face has at most $8k$ monochromatic paths. 
\end{theorem}

$ ((T,r), (B_x)_x)$ is a tree-decomposition with $r$ as the root node. 

\begin{proof}
	Use \cref{lem:planar_graphs_4_connected_cliqesums} to build a tree-decomposition $((T,r), (B_x)_x)$ of $G$ with adhesion $3$. Every torso is either a $4$-connected planar graph or $K_t$ where $t \leq 4$.
	
	Every torso $G \langle B_x \rangle$ has a tree-decomposition where every face is preserved, from \cref{lem:Hamiltonian_preserved_faces}. Then apply \cref{thm:clique_sum_pagenumber_bound} to $((T,r), (B_x)_x)$ to embed $G$ in a book. The number of pages used is $2 \cdot 4 + 3 = 11$. 

	If $v$ is a cut-vertex of $G$, then $v$ is in an adhesion set of torsos $G \langle B_x \rangle$ and $G \langle B_y \rangle$. Assume that $B_y$ is the parent of $B_x$. Then from \cref{thm:clique_sum_pagenumber_bound}, the ordering does not change, so $v$ is not moved anywhere. Then any face $F$ where every vertex on the boundary of $F$ is in $B_x$ is preserved. Since the outerface of $B_x$ is preserved, the colour of the outerface can be changed so that it matches the colour of the face that $B_x$ is a part of. 

	Now suppose $S$ is an adhesion set between bags $B_x$ and the parent $B_y$. Suppose $ S = \{a,b\}$. Let $F$ be a face in $B_x$ and let $F_v$ be the set of vertices that touch $F$. Assume that $F_v \subseteq B_x$. If $F_v \cap S$ is nonempty, then $S$ vertices are moved to the start of $F$. 
	
	No vertex in $S$ is a cut vertex, because that would imply from \cref{lem:planar_graphs_4_connected_cliqesums} that $|S| = 1$. Let $(<_x, \psi_x)$ be a two-page book-embedding of $G \langle B_x \rangle$, from \cref{lem:Hamiltonian_preserved_faces}. Now $F$ has a single monochromatic face.
	From \cref{thm:4-connected_planar_ham_cycle}, there is a Hamiltonian cycle in $B_x$ with edge $ab$ on the cycle. From \cref{lem:Hamiltonian_preserved_faces}, this implies that $ab$ is consecutive on the cycle. From \cref{thm:clique_sum_pagenumber_bound}, this cycle is the same in $B_x$. If $ab$ is the boundary on a face $F$, then every face in $G[B_x \cup B_y]$ is contained in either $B_x$ or $B_y$. So every face is monochromatic. If $ab$ is a chord on a face $F$, $F$ lies in the subtree rooted at $B_x$ and $B_y$. Then $F$ can be coloured with a single monochromatic as we can cycle through colours of $B_x$ so that the colour of $F$ in $B_x$ and the colour of $F$ in $B_y$ matches. Then every face is preserved in the book-embedding. 

	If $S = \{u,v,w\}$, and if $u$ appears on a face $F$, then no vertices are moved around. If $u,v$ appear on a face $F$, then the edge $uv$ is in $B_x$. Then there is a face $F'$ in $B_x$ with the edge $uv$ on its boundary so that $F'$ is a part of $F$. But this means that there is a monochromatic path from $u$ to $v$. In this book-embedding, $u,v,w$ are moved to the very front. Then the edges of $u,v,w$ break the preserved face at $F$ and $F'$. Only the edges that $u$ and $v$ is adjacent to change colours, meaning that the number of monochromatic paths at the end is $8$. Repeat for all cut-sets of size $3$ on the boundary of $F$, and as there are a bounded number of cutsets in $G$, then $F$ has $8k$ monochromatic paths.

\end{proof}	
There is no restriction on the number of planar graphs with cut-sets of size $3$.  There may be an unbounded number of vertices moved from \cref{thm:clique_sum_pagenumber_bound}, meaning that the number of monochromatic paths that are generated is unbounded.

